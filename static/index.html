<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aviso Entity Resolution</title>
    <style>
        /* --- 1. COLOR SYSTEM & VARIABLES --- */
        :root {
            --primary: #6C62D4;    /* From your Image */
            --secondary: #2D3436;  /* Dark Slate for Text */
            --bg: #F3F4F6;         /* Light Gray Background */
            --white: #FFFFFF;
            --success: #00B894;    /* Green for Matches */
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        /* --- 2. GLOBAL STYLES --- */
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, sans-serif;
            background-color: var(--bg);
            color: var(--secondary);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- 3. HEADER --- */
        header {
            background-color: var(--primary);
            width: 100%;
            padding: 1.5rem 0;
            text-align: center;
            color: var(--white);
            box-shadow: var(--shadow);
        }
        header h1 { margin: 0; font-size: 1.8rem; font-weight: 600; }
        header p { margin: 5px 0 0; opacity: 0.9; font-size: 0.9rem; }

        /* --- 4. MAIN CONTAINER --- */
        main {
            width: 90%;
            max-width: 600px;
            margin-top: 3rem;
        }

        /* --- 5. SEARCH BOX (The Input) --- */
        .search-card {
            background: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            text-align: center;
        }
        
        input[type="text"] {
            width: 80%;
            padding: 1rem;
            font-size: 1.1rem;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            outline: none;
            transition: 0.3s;
            margin-bottom: 1.5rem;
        }
        input[type="text"]:focus {
            border-color: var(--primary);
        }

        button {
            background-color: var(--primary);
            color: var(--white);
            border: none;
            padding: 1rem 2.5rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
        }
        button:hover {
            background-color: #5a52b5;
            transform: translateY(-2px);
        }
        button:active { transform: translateY(0); }

        /* --- 6. RESULTS AREA (Hidden by default) --- */
        #result-area {
            margin-top: 2rem;
            display: none; /* Hidden until search */
        }

        .match-card {
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            border-left: 8px solid var(--primary);
            animation: slideIn 0.4s ease-out;
        }

        .match-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .score-badge {
            background: var(--success);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .match-body { padding: 1.5rem; }
        .row { margin-bottom: 10px; display: flex; }
        .label { font-weight: 600; width: 100px; color: #888; }
        .val { font-weight: 500; }

        .colleagues-section {
            background: #FAFAFA;
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
        }
        .colleagues-list {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .colleague-chip {
            background: #EAEAEA;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            color: var(--secondary);
        }

        /* Animation */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

    </style>
</head>
<body>

    <header>
        <h1>Aviso Entity Resolver</h1>
        <p>AI-Powered Lead Matching & Knowledge Graph</p>
    </header>

    <main>
        <div class="search-card">
            <input type="text" id="leadInput" placeholder="e.g. mr. jon doe at acme corp..." autofocus>
            <br>
            <button onclick="resolveLead()">Resolve Entity</button>
        </div>

        <div id="result-area">
            <div class="match-card">
                <div class="match-header">
                    <h2 style="margin:0; font-size:1.2rem;">Match Found</h2>
                    <span class="score-badge" id="scoreBadge">92% Match</span>
                </div>
                
                <div class="match-body">
                    <div class="row">
                        <span class="label">Name:</span>
                        <span class="val" id="resName">John Doe</span>
                    </div>
                    <div class="row">
                        <span class="label">Company:</span>
                        <span class="val" id="resCompany">Acme Corp</span>
                    </div>
                    <div class="row">
                        <span class="label">Email:</span>
                        <span class="val" id="resEmail">john.d@acme.com</span>
                    </div>
                </div>

                <div class="colleagues-section">
                    <small style="text-transform: uppercase; color:#999; font-weight:bold; letter-spacing:1px;">Potential Colleagues</small>
                    <div class="colleagues-list" id="colleaguesList">
                        </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        async function resolveLead() {
            const input = document.getElementById('leadInput').value;
            const resultArea = document.getElementById('result-area');
            
            if(!input) return alert("Please enter a lead name.");

            // Button Loading State
            const btn = document.querySelector('button');
            const originalText = btn.innerText;
            btn.innerText = "Searching Graph...";
            btn.disabled = true;

            try {
                const response = await fetch('/resolve', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ raw_text: input })
                });
                
                const data = await response.json();

                if (data.match_found) {
                    // Populate Data
                    document.getElementById('scoreBadge').innerText = (data.match_score * 100).toFixed(0) + "% Confidence";
                    document.getElementById('resName').innerText = data.match_details.name;
                    document.getElementById('resCompany').innerText = data.match_details.company;
                    document.getElementById('resEmail').innerText = data.match_details.email;
                    
                    // Populate Colleagues
                    const list = document.getElementById('colleaguesList');
                    list.innerHTML = '';
                    if(data.potential_colleagues && data.potential_colleagues.length > 0) {
                        data.potential_colleagues.forEach(c => {
                            const chip = document.createElement('div');
                            chip.className = 'colleague-chip';
                            chip.innerText = c;
                            list.appendChild(chip);
                        });
                    } else {
                        list.innerHTML = '<span style="color:#999; font-size:0.9rem;">No connections found in graph.</span>';
                    }

                    // Show Result
                    resultArea.style.display = "block";
                } else {
                    alert("No match found for this lead.");
                    resultArea.style.display = "none";
                }

            } catch (error) {
                console.error(error);
                alert("Error connecting to server.");
            }

            // Reset Button
            btn.innerText = originalText;
            btn.disabled = false;
        }
    </script>
</body>
</html>